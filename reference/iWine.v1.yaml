openapi: 3.0.0
info:
  title: iWine
  version: '1.0'
  contact:
    name: Dmitry
    email: dima@melodrom.ru
  description: 'LAN API for iWine devices. Get current wine volume (in litres), alcohol contents (per cent), sugar (per cent), temperature, wine type (as a JSON list of strings and certainty values: {"red":90, "white":1,  "rose":9, "orange":0}). Aerate contents or cool/warm to a desired temperature. Set callback url to receive notifications to your device within LAN.'
  license:
    name: GPL
servers:
  - url: localhost
    description: ''
paths:
  /status:
    get:
      summary: Your GET endpoint
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: string
                description: Status responce encrypted payload in base64
                minLength: 180
                maxLength: 188
                pattern: '^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$'
              examples: {}
        '401':
          description: Unauthorized
      operationId: get-status
      description: Returns JSON with device status information
      requestBody:
        content:
          application/json:
            schema:
              $ref: ''
      parameters:
        - schema:
            type: string
            maxLength: 22
            minLength: 22
            pattern: '^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$'
          in: query
          name: key
          description: Controller public key base64
          required: true
        - schema:
            type: string
          in: query
          name: sig
          description: Controller public key signed with private key
          required: true
  /command:
    post:
      summary: ''
      operationId: post-command
      responses:
        '200':
          description: OK
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
          headers: {}
        '422':
          description: Unprocessable Entity
      requestBody:
        content:
          application/json:
            schema:
              type: object
              description: Operations request encrypted payload + signature
              properties:
                payload:
                  type: string
                  maxLength: 1024
                  pattern: '^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$'
                  description: Operations request encrypted payload
                sig:
                  type: string
                  minLength: 44
                  maxLength: 44
                  pattern: '^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$'
                  description: Operations request encrypted payload signed with Controller private key
        description: ''
  /pair:
    post:
      summary: ''
      operationId: post-pair
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: string
                description: iWine device name and ed25519 public key
                minLength: 22
                maxLength: 22
                pattern: '^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$'
          headers: {}
        '400':
          description: |-
            Bad Request
            Switch iWine to pairing mode first
      requestBody:
        content:
          application/json:
            schema:
              type: string
              description: Requesting device name and ed25519 public key
              minLength: 22
              maxLength: 22
              pattern: '^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$'
    parameters: []
components:
  schemas: {}
  securitySchemes:
    Public key exchange:
      type: http
      scheme: hoba
      description: "When in pairing mode iWine will accept Controller \nPOST request to `/pair` endpoint with Controller public key and return 200 OK with iWine public key in responce body"
